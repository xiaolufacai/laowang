{include file="/layout/header" /}

<!-- Vue 2 + Quill 富文本编辑器 -->
<div id="app" style="background-color: #ffffff">
    <el-container>
        <el-header style="text-align: right; font-size: 12px">
            包名
            <el-form :inline="true" :model="formInline" class="demo-form-inline">
                <el-form-item>
                    <el-select v-model="formInline.app" @change="select" placeholder="APP">
                        <el-option
                                v-for="(item, index) in apps"
                                :key="index"
                                :label="item.name"
                                :value="item.id">
                        </el-option>
                    </el-select>
                </el-form-item>
            </el-form>
        </el-header>

        <el-main>
            <el-row>
                <el-col :span="12">
                    <h3>用户协议</h3>
                    <quill-editor v-model="userAgreement" :options="editorOptions" />
                </el-col>
                <el-col :span="12">
                    <h3>隐私协议</h3>
                    <quill-editor v-model="privacyAgreement" :options="editorOptions" />
                </el-col>
            </el-row>
        </el-main>
    </el-container>
</div>

<style>
    .diy-el-form {
        background-color: #fff;
    }
    .demo-form-inline {
        margin-top: 10px;
    }
    .el-header {
        background-color: #e7ebf0;
        color: #333;
        line-height: 60px;
    }
    .el-aside {
        color: #333;
    }
</style>

<script type="module">

    // 引入 Quill 和 vue-quill-editor 通过 CDN
    import { Quill } from 'https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js';  // Quill 富文本编辑器
    import VueQuillEditor from 'https://cdn.jsdelivr.net/npm/vue-quill-editor@3.0.6/dist/vue-quill-editor.min.js';  // Vue2 版本的 Quill 编辑器

    // 注册 VueQuillEditor 作为全局组件
    Vue.component('quill-editor', VueQuillEditor);

    const initForm = {
        name: '',
        repository: '',
        package_url: '',
        ad_id: '',
        ym_id: '',
        wx_id: '',
        app_id: ''
    }
    const _initForm = Object.assign({}, initForm);
    Object.freeze(_initForm);

    var Main = {
        data() {
            return {
                formInline: {
                    app: {}
                },
                tableObject: {
                    '包名': '',
                    'coding仓库地址': "",
                    '打包平台地址': "",
                    '广告id': "",
                    '友盟id': "",
                    '微信id': "",
                    'appld': ""
                },
                ruleForm: initForm,
                formVisible: false,
                apps: [],
                userAgreement: '',  // 用户协议富文本
                privacyAgreement: '',  // 隐私协议富文本
                editorOptions: {
                    theme: 'snow',  // 富文本编辑器主题
                    placeholder: '在此输入协议内容...',  // 协议内容占位符
                }
            }
        },
        created: function () {
            this.getApps();  // 获取所有应用数据
        },
        methods: {
            getApps() {
                let _this = this;
                axios.get('/admin/app/apps', {})
                    .then(response => {
                        const data = response.data.data;
                        const code = response.data.code;
                        if (code !== 0) {
                            _this.apps = [];
                        } else {
                            _this.apps = data;
                            if (_this.apps.length > 0) {
                                let index = _this.apps.length - 1;
                                _this.formInline.app = _this.apps[index];
                                _this.select(_this.apps[index].id);
                            }
                        }
                    })
                    .catch(function (error) {
                        _this.$message({
                            message: '数据获取失败',
                            type: 'error'
                        });
                    })
            },
            select(id) {
                let value = this.apps.find(item => item.id === id);
                if (value) {
                    this.tableObject = {
                        '包名': value.name,
                        'coding仓库地址': value.repository,
                        '打包平台地址': value.package_url,
                        '广告ID': value.ad_id,
                        '友盟ID': value.ym_id,
                        '微信ID': value.wx_id,
                        'APP ID': value.app_id
                    };

                    // 更新富文本内容
                    this.userAgreement = value.user_agreement || '';
                    this.privacyAgreement = value.privacy_agreement || '';
                }
            }
        },
        computed: {
            transformedData() {
                return Object.keys(this.tableObject).map(key => ({
                    field: key,
                    value: this.tableObject[key]
                }));
            }
        }
    }

    var Ctor = Vue.extend(Main);
    new Ctor().$mount('#app');
</script>

{include file="/layout/footer" /}
